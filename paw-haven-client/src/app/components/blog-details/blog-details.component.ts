import { CommonModule } from '@angular/common';
import { Component, OnInit } from '@angular/core';
import { ActivatedRoute, Router, RouterLink } from '@angular/router';
import { PawLoaderComponent } from '../shared/paw-loader/paw-loader.component';

interface BlogPost {
  id: number;
  title: string;
  content: string;
  imageUrl: string;
  author: string;
  authorAvatar?: string;
  date: string;
  tags: string[];
  category: string;
  likes: number;
  comments: number;
  views: number;
  isFeatured: boolean;
  excerpt: string;
}

@Component({
  selector: 'app-blog-details',
  standalone: true,
  imports: [CommonModule, RouterLink, PawLoaderComponent],
  templateUrl: './blog-details.component.html',
  styleUrl: './blog-details.component.scss'
})
export class BlogDetailsComponent implements OnInit {
  blogPost: BlogPost | null = null;
  relatedPosts: BlogPost[] = [];
  isLoading = true;
  errorMessage = '';

  constructor(
    private route: ActivatedRoute,
    private router: Router
  ) { }

  ngOnInit(): void {
    this.route.paramMap.subscribe(params => {
      const id = Number(params.get('id'));
      
      if (isNaN(id)) {
        this.errorMessage = 'Невірний ідентифікатор статті';
        this.isLoading = false;
        return;
      }
      
      // Імітуємо завантаження даних
      setTimeout(() => {
        this.loadBlogPost(id);
        this.isLoading = false;
      }, 800);
    });
  }

  loadBlogPost(id: number): void {
    // Мокові дані - в реальному додатку це мало б прийти з сервісу
    const allPosts: BlogPost[] = [
      {
        id: 1,
        title: 'Як правильно доглядати за собакою в зимовий період',
        content: `
          <p>Зима - це складний період для собак, особливо для тих, хто живе в регіонах з суворим кліматом. Ось декілька порад, як забезпечити вашому чотирилапому другу комфорт і здоров'я в холодну пору року.</p>
          
          <h3>Захист від холоду</h3>
          <p>Навіть собаки з густою шерстю потребують додаткового захисту при низьких температурах. Для короткошерстих порід спеціальний одяг - не розкіш, а необхідність. Обирайте водонепроникний, теплий одяг, який не обмежує рухи.</p>
          
          <h3>Догляд за лапами</h3>
          <p>Сіль і реагенти на дорогах можуть призвести до подразнення і тріщин на подушечках лап. Після кожної прогулянки обов'язково промивайте лапи теплою водою і витирайте насухо. Можна використовувати спеціальні захисні креми або воскові сапожки.</p>
          
          <h3>Харчування</h3>
          <p>В холодну пору року собаки витрачають більше енергії для підтримання температури тіла. Скоригуйте раціон, збільшивши калорійність, особливо якщо ваш собака багато часу проводить надворі.</p>
          
          <h3>Активність і прогулянки</h3>
          <p>Незважаючи на холод, собакам потрібні регулярні прогулянки і фізична активність. Скоротіть тривалість прогулянок, але збільшіть їх інтенсивність. Обирайте сонячний час і уникайте виходу в найхолодніші години.</p>
          
          <p>Дотримуючись цих простих правил, ви забезпечите вашому улюбленцю комфортну і безпечну зиму!</p>
        `,
        imageUrl: 'assets/images/blog/dog.jpg',
        author: 'Марія Петренко',
        authorAvatar: 'assets/images/avatars/maria.jpg',
        date: '2025-03-15',
        tags: ['Догляд', 'Зима', 'Собаки'],
        category: 'Догляд за тваринами',
        likes: 128,
        comments: 24,
        views: 3567,
        isFeatured: true,
        excerpt: 'Корисні поради щодо догляду за собаками в зимовий період: від захисту лап до правильного харчування'
      },
      {
        id: 2,
        title: 'Як обрати правильний корм для котів різного віку',
        content: `
          <p>Правильне харчування - запорука здоров'я і довголіття вашого кота. Різний вік має різні потреби в поживних речовинах, і розуміння цих особливостей допоможе обрати оптимальний раціон.</p>
          
          <h3>Кошенята (до 1 року)</h3>
          <p>Кошенята ростуть швидко і потребують корму з високим вмістом білка і жиру для підтримки розвитку м'язів, органів і кісток. Шукайте корми, спеціально розроблені для кошенят, які містять необхідні вітаміни і мінерали.</p>
          
          <h3>Дорослі коти (1-7 років)</h3>
          <p>Дорослим котам потрібен збалансований корм з помірним вмістом білка і жиру для підтримки здорової ваги. Обирайте корми, які відповідають рівню активності вашого кота - для домашніх котів існують спеціальні формули з меншою калорійністю.</p>
          
          <h3>Літні коти (7+ років)</h3>
          <p>З віком метаболізм котів сповільнюється, і вони стають менш активними. Корм для літніх котів має менше калорій, але більше клітковини для підтримки травлення. Також важливі добавки для суглобів і імунної системи.</p>
          
          <h3>Особливі потреби</h3>
          <p>Деякі коти мають специфічні потреби через проблеми зі здоров'ям - надмірну вагу, алергії, захворювання нирок чи сечовивідних шляхів. Для таких випадків існують спеціальні лікувальні корми, які призначає ветеринар.</p>
          
          <p>Пам'ятайте, що будь-які зміни в раціоні кота слід вводити поступово, протягом 7-10 днів, змішуючи новий корм зі старим. Це допоможе уникнути проблем з травленням і відмови від їжі.</p>
        `,
        imageUrl: 'assets/images/blog/cat.jpg',
        author: 'Олександр Коваленко',
        authorAvatar: 'assets/images/avatars/oleksandr.jpg',
        date: '2025-04-02',
        tags: ['Харчування', 'Коти', 'Здоров\'я'],
        category: 'Здоров\'я',
        likes: 95,
        comments: 18,
        views: 2415,
        isFeatured: false,
        excerpt: 'Поради щодо вибору оптимального корму для котів різних вікових груп з урахуванням їхніх особливих потреб'
      },
      {
        id: 3,
        title: 'Історія порятунку: як Барсик знайшов новий дім після повені',
        content: `
          <p>Коли стихійне лихо вдарило по невеликому містечку на заході України, багато тварин залишилися без дому. Серед них був і молодий кіт Барсик, якого волонтери знайшли на даху затопленого будинку.</p>
          
          <h3>Порятунок</h3>
          <p>Барсик провів майже три дні без їжі, перелякано тримаючись за дах будинку, оточений водою. Команда рятувальників помітила його під час обстеження території човном і змогла безпечно дістати кота.</p>
          
          <h3>Реабілітація</h3>
          <p>У притулку виявилося, що Барсик, на щастя, не отримав серйозних травм, але був сильно зневоднений і виснажений. Після ветеринарного огляду, лікування і відновлення сил, кіт почав проявляти свій справжній характер - грайливий і дружелюбний.</p>
          
          <h3>Нова родина</h3>
          <p>Історія Барсика швидко розлетілася соціальними мережами завдяки зворушливому відео його порятунку. Серед багатьох бажаючих взяти кота, притулок обрав молоду сім'ю з їхнього ж міста, яка, хоч і втратила чимало майна під час повені, але мала вціліле житло і бажання допомогти тварині в біді.</p>
          
          <h3>Щасливий фінал</h3>
          <p>Сьогодні Барсик - щасливий домашній кіт, який насолоджується увагою своїх нових господарів. Він став символом стійкості і надії для місцевої громади, яка продовжує відновлюватися після стихії.</p>
          
          <p>Ця історія нагадує нам, що навіть у найтемніші часи є місце для співчуття і любові, і що порятунок однієї тварини може принести світло у життя багатьох людей.</p>
        `,
        imageUrl: 'assets/images/blog/cats.jpg',
        author: 'Тетяна Іванова',
        authorAvatar: 'assets/images/avatars/tetiana.jpg',
        date: '2025-03-28',
        tags: ['Порятунок', 'Коти', 'Історії'],
        category: 'Історії порятунку',
        likes: 215,
        comments: 43,
        views: 5824,
        isFeatured: true,
        excerpt: 'Зворушлива історія кота Барсика, врятованого після повені, та його шлях до нової люблячої родини'
      },
      {
        id: 4,
        title: '5 основних команд, яким ви можете навчити свого собаку самостійно',
        content: `
          <p>Навчання собаки базовим командам не тільки робить ваше спільне життя зручнішим, але й стимулює розумовий розвиток вашого улюбленця. Пропонуємо 5 основних команд, які можна освоїти в домашніх умовах.</p>
          
          <h3>1. "Сидіти"</h3>
          <p>Найпростіша і найважливіша команда. Тримайте ласощі над головою собаки, повільно рухаючи руку назад. Коли собака сяде, скажіть "Сидіти" і відразу дайте ласощі. Повторюйте кілька разів на день, поступово прибираючи жест, залишаючи тільки голосову команду.</p>
          
          <h3>2. "Лежати"</h3>
          <p>Коли собака сидить, тримайте ласощі перед носом і рухайте рукою вниз до підлоги, потім вперед. Собака природньо ляже, слідуючи за вашою рукою. Скажіть "Лежати" і нагородіть ласощами.</p>
          
          <h3>3. "Стояти"</h3>
          <p>З положення сидячи, тримайте ласощі перед носом собаки і рухайте руку вперед так, щоб собака встав. Скажіть "Стояти" і віддайте ласощі.</p>
          
          <h3>4. "До мене"</h3>
          <p>Показуйте собаці ласощі і кажіть "До мене" енергійним, заохочувальним тоном. Коли собака підійде, давайте ласощі і багато похвали. Ніколи не карайте собаку після цієї команди, навіть якщо він зробив щось неправильне перед цим.</p>
          
          <h3>5. "Місце"</h3>
          <p>Визначте місце для собаки (килимок або лежак). Підведіть собаку туди, скажіть "Місце" і спонукайте лягти, нагородивши ласощами. Поступово збільшуйте відстань і час, який собака має залишатися на місці.</p>
          
          <p>Пам'ятайте: терпіння, послідовність і позитивне підкріплення - ключі до успішного навчання. Тренуйтеся регулярно, але коротко (5-10 хвилин за раз), і завжди завершуйте на позитивній ноті.</p>
        `,
        imageUrl: 'assets/images/blog/hurt.jpg',
        author: 'Ігор Сидоренко',
        authorAvatar: 'assets/images/avatars/ihor.jpg',
        date: '2025-04-05',
        tags: ['Тренування', 'Собаки', 'Поради'],
        category: 'Тренування',
        likes: 163,
        comments: 32,
        views: 4290,
        isFeatured: false,
        excerpt: 'Покрокова інструкція з навчання собаки п\'яти базовим командам: сидіти, лежати, стояти, до мене і місце'
      },
      {
        id: 5,
        title: 'Як правильно спілкуватися з кішкою: розуміємо мову тіла',
        content: `
          <p>Кішки спілкуються переважно невербально, і розуміння їхньої мови тіла допоможе вам краще розуміти вашого пухнастого друга і будувати гармонійні стосунки.</p>
          
          <h3>Хвіст розповідає історію</h3>
          <p>• Піднятий вгору хвіст - кішка рада вас бачити і перебуває в хорошому настрої.<br>
          • Хвіст, що метляється з боку в бік - ознака роздратування або збудження; будьте обережні.<br>
          • Хвіст між ніг - кішка налякана або підкоряється.<br>
          • Розпушений хвіст - крайній ступінь страху або агресії.</p>
          
          <h3>Очі - дзеркало душі</h3>
          <p>• Розширені зіниці - збудження або страх.<br>
          • Повільне моргання - знак довіри і прихильності. Спробуйте "моргнути" у відповідь!<br>
          • Прямий пильний погляд - може бути ознакою агресії або виклику.</p>
          
          <h3>Вуха та їхнє положення</h3>
          <p>• Вуха спрямовані вперед - кішка зацікавлена і уважна.<br>
          • Вуха притиснуті до голови - ознака страху або агресії.<br>
          • Постійно рухливі вуха - кішка настороженна і оцінює ситуацію.</p>
          
          <h3>Мурчання - не завжди задоволення</h3>
          <p>Хоча мурчання часто асоціюється з задоволенням, кішки також можуть мурчати, коли вони хворі або відчувають біль - це спосіб самозаспокоєння. Зверніть увагу на інші ознаки самопочуття.</p>
          
          <h3>Як правильно гладити</h3>
          <p>Більшість кішок насолоджуються погладжуванням під підборіддям, за вухами та вздовж спини. Уникайте живота - багато кішок сприймають це як загрозу, навіть якщо добровільно показують свій живіт.</p>
          
          <p>Пам'ятайте, що кожна кішка індивідуальна, і з часом ви навчитеся розуміти особливості комунікації саме вашого улюбленця. Повага до його особистого простору і уважність до сигналів - ключ до міцного зв'язку.</p>
        `,
        imageUrl: 'assets/images/blog/hurt.jpg',
        author: 'Наталія Шевченко',
        authorAvatar: 'assets/images/avatars/natalia.jpg',
        date: '2025-03-20',
        tags: ['Коти', 'Комунікація', 'Поведінка'],
        category: 'Поради',
        likes: 187,
        comments: 29,
        views: 4675,
        isFeatured: true,
        excerpt: 'Навчіться розуміти мову тіла кішок - від положення хвоста до міміки, щоб покращити ваш зв\'язок з улюбленцем'
      },
      {
        id: 6,
        title: 'Першочергові кроки при знаходженні травмованої тварини',
        content: `
          <p>Зіткнувшись з травмованою твариною, важливо діяти швидко, але обережно. Ось покрокова інструкція, що допоможе вам надати першу допомогу і не нашкодити.</p>
          
          <h3>Крок 1: Забезпечте безпеку</h3>
          <p>Перш за все, подбайте про власну безпеку і безпеку оточуючих. Навіть домашні тварини в стресі можуть вкусити або подряпати. Якщо тварина агресивна, викличте спеціалістів.</p>
          
          <h3>Крок 2: Оцініть стан</h3>
          <p>Спокійно оцініть стан тварини з безпечної відстані. Зверніть увагу на очевидні травми, кров, утруднене дихання, нестійкість на ногах. Використовуйте ліхтарик, якщо необхідно, але не світіть прямо в очі.</p>
          
          <h3>Крок 3: Обережне поводження</h3>
          <p>Якщо тварина дозволяє наблизитися, рухайтесь повільно і говоріть м'яким голосом. Для дрібних тварин підготуйте ковдру або рушник для обгортання. Для більших тварин може знадобитися імпровізовані ноші.</p>
          
          <h3>Крок 4: Базова перша допомога</h3>
          <p>• При кровотечі: прикладіть чисту тканину з легким тиском.<br>
          • При переломах: мінімізуйте рух, не намагайтеся виправити кістку.<br>
          • При опіках: охолодіть уражену ділянку прохолодною (не холодною!) водою.<br>
          • При тепловому ударі: перемістіть у тінь, прикладіть вологу тканину.</p>
          
          <h3>Крок 5: Термінова ветеринарна допомога</h3>
          <p>Найважливіше - якнайшвидше доставити тварину до ветеринара. Заздалегідь зателефонуйте в клініку, щоб вони підготувалися до вашого приїзду. Майте список цілодобових ветклінік у вашому телефоні.</p>
          
          <h3>Що НЕ робити:</h3>
          <p>• Не давайте людські ліки без консультації ветеринара.<br>
          • Не годуйте і не поїть тварину, якщо вона непритомна або має внутрішні травми.<br>
          • Не знімайте предмети, що застрягли в рані - це може викликати сильну кровотечу.<br>
          • Не ігноруйте навіть незначні на вигляд травми - вони можуть бути серйознішими, ніж здаються.</p>
          
          <p>Ваша швидка й обережна реакція може врятувати життя тварині. Розгляньте можливість пройти курс першої допомоги для тварин, щоб бути краще підготовленим до таких ситуацій.</p>
        `,
        imageUrl: 'assets/images/blog/hurt.jpg',
        author: 'Дмитро Мельник',
        authorAvatar: 'assets/images/avatars/dmytro.jpg',
        date: '2025-03-10',
        tags: ['Перша допомога', 'Рятування', 'Надзвичайна ситуація'],
        category: 'Здоров\'я',
        likes: 240,
        comments: 52,
        views: 7120,
        isFeatured: true,
        excerpt: 'Детальна інструкція з надання першої допомоги травмованим тваринам: від оцінки ситуації до транспортування до ветеринара'
      }
    ];

    // Знаходимо потрібну статтю за ID
    this.blogPost = allPosts.find(post => post.id === id) || null;
    
    if (!this.blogPost) {
      this.errorMessage = 'Статтю не знайдено';
      return;
    }
    
    // Знаходимо пов'язані статті тієї ж категорії, виключаючи поточну
    this.relatedPosts = allPosts
      .filter(post => post.category === this.blogPost?.category && post.id !== id)
      .slice(0, 3); // Обмеження до 3 пов'язаних статей
  }

  formatDate(dateString: string): string {
    const date = new Date(dateString);
    const options: Intl.DateTimeFormatOptions = { 
      day: 'numeric', 
      month: 'long', 
      year: 'numeric' 
    };
    return date.toLocaleDateString('uk-UA', options);
  }

  navigateBack(): void {
    this.router.navigate(['/blog']);
  }
}